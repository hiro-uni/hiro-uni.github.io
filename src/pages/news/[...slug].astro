---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

export async function getStaticPaths() {
	const newsEntries = await getCollection('news');
	// 日付順（新しい順）に並べ替え
	const sortedNews = newsEntries.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

	return sortedNews.map((entry, index) => ({
		params: { slug: entry.slug },
		props: {
			entry,
			prev: index < sortedNews.length - 1 ? sortedNews[index + 1] : null, // 古い記事
			next: index > 0 ? sortedNews[index - 0 - 1] : null, // 新しい記事
		},
	}));
}

const { entry, prev, next } = Astro.props;
const { Content } = await entry.render();
---

<Layout title={`${entry.data.title}`}>
	<div class="news-content">
		<header class="news-header">
			<time datetime={entry.data.pubDate.toISOString()}>
				{entry.data.pubDate.toLocaleDateString('ja-JP')}
			</time>
		</header>
		
		<div class="markdown-body">
			<Content />
		</div>

		<nav class="news-navigation">
			<div class="nav-next">
				{next && (
					<a href={`/news/${next.slug}`}>
						<span class="nav-label">&larr; 次の記事</span>
						<span class="nav-title">{next.data.title}</span>
					</a>
				)}
			</div>
			<div class="nav-prev">
				{prev && (
					<a href={`/news/${prev.slug}`}>
						<span class="nav-label">前の記事 &rarr;</span>
						<span class="nav-title">{prev.data.title}</span>
					</a>
				)}
			</div>
		</nav>
	</div>
</Layout>

<style>
	.news-header {
		margin-bottom: 2rem;
		color: #666;
	}
	.markdown-body {
		line-height: 1.8;
	}
	.markdown-body :global(h1) {
		display: none; /* Layoutのtitleと重複するため */
	}
	.markdown-body :global(h2) {
		margin-top: 2rem;
	}
	.markdown-body :global(ul) {
		margin: 1rem 0;
	}
	.markdown-body :global(table) {
		width: 100%;
		border-collapse: collapse;
		margin: 1.5rem 0;
	}
	.markdown-body :global(th),
	.markdown-body :global(td) {
		border: 1px solid #ddd;
		padding: 8px 12px;
		text-align: left;
	}
	.markdown-body :global(th) {
		background-color: #f9f9f9;
	}

	.news-navigation {
		display: grid;
		grid-template-columns: 1fr 1fr;
		gap: 1rem;
		margin-top: 4rem;
		padding-top: 2rem;
		padding-bottom: 2rem;
		border-top: 1px solid #eee;
	}
	.nav-prev, .nav-next {
		display: flex;
	}
	.nav-prev {
		justify-content: flex-end;
		text-align: right;
	}
	.news-navigation a {
		text-decoration: none;
		display: flex;
		flex-direction: column;
		gap: 0.5rem;
		max-width: 100%;
	}
	.nav-label {
		font-size: 0.85rem;
		color: #888;
		font-weight: bold;
	}
	.nav-title {
		color: var(--accent);
		font-weight: bold;
		line-height: 1.4;
	}
	.news-navigation a:hover .nav-title {
		text-decoration: underline;
	}

	@media (max-width: 600px) {
		.news-navigation {
			grid-template-columns: 1fr;
			gap: 2rem;
		}
	}
	.markdown-body :global(.ogp-card) {
		display: block;
		text-decoration: none;
		color: inherit !important;
		margin: 2rem 0;
		background: #fff;
		border: 1px solid #eee;
		border-radius: 12px;
		overflow: hidden;
		transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
		box-shadow: 0 2px 10px rgba(0,0,0,0.03);
		line-height: 1.4;
	}

	.markdown-body :global(.ogp-card:hover) {
		transform: translateY(-4px);
		box-shadow: 0 10px 20px rgba(0,0,0,0.08);
		border-color: #e43983;
	}

	.markdown-body :global(.ogp-card-content) {
		display: flex;
		padding: 0;
		min-height: 140px;
	}

	.markdown-body :global(.ogp-card-info) {
		flex: 1;
		padding: 1.5rem;
		display: flex;
		flex-direction: column;
		justify-content: center;
	}

	.markdown-body :global(.ogp-site-name) {
		font-size: 0.75rem;
		color: #888;
		margin: 0 0 0.5rem 0;
		text-transform: uppercase;
		letter-spacing: 0.05em;
	}

	.markdown-body :global(.ogp-card-title) {
		font-size: 1.15rem;
		line-height: 1.4;
		margin: 0 0 0.5rem 0;
		font-weight: 700;
		color: #333;
		display: -webkit-box;
		-webkit-line-clamp: 2;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}

	.markdown-body :global(.ogp-card-description) {
		font-size: 0.9rem;
		color: #666;
		margin: 0;
		line-height: 1.5;
		display: -webkit-box;
		-webkit-line-clamp: 2;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}

	.markdown-body :global(.ogp-card-image) {
		width: 240px;
		flex-shrink: 0;
		border-left: 1px solid #eee;
	}

	.markdown-body :global(.ogp-card-image img) {
		width: 100%;
		height: 100%;
		object-fit: cover;
		margin: 0;
	}

	@media (max-width: 600px) {
		.markdown-body :global(.ogp-card-content) {
			flex-direction: column-reverse;
		}
		.markdown-body :global(.ogp-card-image) {
			width: 100%;
			height: 160px;
			border-left: none;
			border-bottom: 1px solid #eee;
		}
		.markdown-body :global(.ogp-card-info) {
			padding: 1rem;
		}
		.markdown-body :global(.ogp-card-title) {
			font-size: 1rem;
		}
	}
</style>

