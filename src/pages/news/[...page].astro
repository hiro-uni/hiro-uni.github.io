---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

export async function getStaticPaths({ paginate }) {
	const newsEntries = await getCollection('news');
	// 日付順（新しい順）に並べ替え
	const sortedNews = newsEntries.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
	
	return paginate(sortedNews, { pageSize: 5 });
}

const { page } = Astro.props;
const title = `最新ニュース ${page.currentPage > 1 ? `(Page ${page.currentPage})` : ''} - 広島Unity勉強会`;
---

<Layout title={title}>
	<p>コミュニティの動向や過去のイベント記録などをお知らせします。</p>

	<div class="news-list">
		{page.data.map((entry) => (
			<article class="news-item">
				<time datetime={entry.data.pubDate.toISOString()}>
					{entry.data.pubDate.toLocaleDateString('ja-JP')}
				</time>
				<h3>
					<a href={`/news/${entry.slug}`}>{entry.data.title}</a>
				</h3>
				<p>{entry.data.description}</p>
			</article>
		))}
	</div>

	<nav class="pagination">
		{page.url.prev ? <a href={page.url.prev}>&larr; 前のページ</a> : <span class="disabled">&larr; 前のページ</span>}
		<span class="page-count">Page {page.currentPage} / {page.lastPage}</span>
		{page.url.next ? <a href={page.url.next}>次のページ &rarr;</a> : <span class="disabled">次のページ &rarr;</span>}
	</nav>

	<p class="connpass-note">イベント情報については <a href="https://hirouni.connpass.com/" target="_blank">connpass</a> も合わせてご確認ください。</p>
</Layout>

<style>
	.news-list {
		margin: 2rem 0;
	}
	.news-item {
		margin-bottom: 2rem;
		padding-bottom: 1.5rem;
		border-bottom: 1px solid #eee;
	}
	.news-item time {
		color: #666;
		font-size: 0.9rem;
	}
	.news-item h3 {
		margin: 0.5rem 0;
		border-bottom: none;
		padding-bottom: 0;
	}
	.news-item h3 a {
		text-decoration: none;
		color: var(--text);
	}
	.news-item h3 a:hover {
		color: var(--secondary);
	}
	.news-item p {
		margin: 0.5rem 0 0;
		color: #444;
	}

	.pagination {
		display: flex;
		justify-content: center;
		align-items: center;
		gap: 2rem;
		margin: 3rem 0;
	}
	.pagination a {
		text-decoration: none;
		font-weight: bold;
		padding: 0.5rem 1rem;
		border: 1px solid var(--accent);
		border-radius: 4px;
	}
	.pagination a:hover {
		background-color: var(--accent);
		color: white;
	}
	.pagination .disabled {
		color: #ccc;
		padding: 0.5rem 1rem;
		border: 1px solid #eee;
		border-radius: 4px;
	}
	.pagination .page-count {
		font-weight: bold;
	}

	.connpass-note {
		margin-top: 3rem;
		background: #f0f7ff;
		padding: 1rem;
		border-radius: 4px;
		text-align: center;
	}
</style>
